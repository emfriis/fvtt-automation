{
  "name": "Death Ward",
  "type": "spell",
  "img": "systems/dnd5e/icons/spells/horror-eerie-2.jpg",
  "data": {
    "description": {
      "value": "<p>You touch a creature and grant it a measure of protection from death.</p>\n<p>The first time the target would drop to 0 hit points as a result of taking damage, the target instead drops to 1 hit point, and the spell ends.</p>\n<p>If the spell is still in effect when the target is subjected to an effect that would kill it instantaneously without dealing damage, that effect is instead negated against the target, and the spell ends.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "Basic Rules, Player's Handbook pg 230",
    "activation": {
      "type": "action",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 8,
      "units": "hour"
    },
    "target": {
      "value": null,
      "width": null,
      "units": "touch",
      "type": ""
    },
    "range": {
      "value": null,
      "long": null,
      "units": "touch"
    },
    "uses": {
      "value": null,
      "max": "",
      "per": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "util",
    "attackBonus": 0,
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": ""
    },
    "damage": {
      "parts": [],
      "versatile": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "level": 4,
    "school": "abj",
    "components": {
      "value": "",
      "vocal": true,
      "somatic": true,
      "material": false,
      "ritual": false,
      "concentration": false
    },
    "materials": {
      "value": "",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": true
    },
    "scaling": {
      "mode": "none",
      "formula": ""
    },
    "attunement": null
  },
  "effects": [
    {
      "_id": "CWSLCQ0FCwAgKW10",
      "changes": [
        {
          "key": "macro.itemMacro.GM",
          "mode": 0,
          "value": "",
          "priority": "0"
        }
      ],
      "disabled": false,
      "duration": {
        "startTime": null
      },
      "icon": "systems/dnd5e/icons/spells/horror-eerie-2.jpg",
      "label": "Death Ward",
      "origin": "Item.IftxYcFFP0p2fgGI",
      "transfer": false,
      "flags": {
        "dae": {
          "selfTarget": false,
          "stackable": "none",
          "durationExpression": "",
          "macroRepeat": "none",
          "specialDuration": [],
          "transfer": false
        },
        "core": {
          "statusId": ""
        },
        "dnd5e-helpers": {
          "rest-effect": "Ignore"
        },
        "ActiveAuras": {
          "isAura": false,
          "aura": "None",
          "radius": null,
          "alignment": "",
          "type": "",
          "ignoreSelf": false,
          "height": false,
          "hidden": false,
          "displayTemp": false,
          "hostile": false,
          "onlyOnce": false
        }
      },
      "tint": "",
      "selectedKey": "macro.itemMacro.GM"
    }
  ],
  "flags": {
    "ddbimporter": {
      "id": 136509,
      "definitionId": 2061,
      "entityTypeId": 435869154,
      "dndbeyond": {
        "lookup": "generic",
        "lookupName": "generic",
        "level": null,
        "castAtLevel": null
      },
      "originalName": "Death Ward",
      "sources": [
        {
          "sourceId": 1,
          "pageNumber": null,
          "sourceType": 2
        },
        {
          "sourceId": 2,
          "pageNumber": 230,
          "sourceType": 1
        }
      ],
      "tags": [
        "Buff",
        "Warding"
      ],
      "version": "2.9.59",
      "effectsApplied": true
    },
    "betterRolls5e": {
      "quickVersatile": {
        "altValue": true
      },
      "quickCharges": {
        "value": {
          "use": true,
          "resource": true
        },
        "altValue": {
          "use": true,
          "resource": true
        }
      }
    },
    "core": {
      "sourceId": "Compendium.world.ddb-spells.S2yvIbRfptZfoU8f"
    },
    "midi-qol": {
      "effectActivation": false,
      "onUseMacroName": ""
    },
    "midiProperties": {
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "rollOther": false,
      "critOther": false,
      "magicdam": false,
      "magiceffect": false,
      "concentration": false,
      "toggleEffect": false
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "itemacro": {
      "macro": {
        "data": {
          "_id": null,
          "name": "Death Ward",
          "type": "script",
          "author": "otqBqyqMuTGDffTr",
          "img": "icons/svg/dice-target.svg",
          "scope": "global",
          "command": "// death ward\n\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\nconst target = canvas.tokens.get(lastArg.tokenId)\n\nconst DAEItem = lastArg.efData.flags.dae.itemData\n\nlet caster = canvas.tokens.placeables.find(token => token?.actor?.items.get(DAEItem._id) != null)\n\nif (args[0] === \"on\") {\n    DAE.setFlag(tactor, \"DeathWardIds\", caster.actor.id)\n    SetDeathWard()\n}\n\nif (args[0] === \"off\") {\n        RemoveHook()\n        DAE.unsetFlag(tactor, \"DeathWardIds\");\n\t\tconsole.log(\"Death Ward removed\");\n}\nif (args[0] === \"each\") {\n        RemoveHook()\n        SetDeathWard()\n\t\t\n}\n\n function SetDeathWard() {\n    const hookId = Hooks.on(\"preUpdateActor\", async (actor, update, options, id) => {\n        if (tactor.id !== actor.id) return\n        let hp = getProperty(update, \"data.attributes.hp.value\");\n        if (hp === 0) {\n            update.data.attributes.hp.value = 1;\n            ChatMessage.create({ content: `Death Ward prevents ${actor.name} from dying` });\n\t\t\t\n\t\t\tlet dead = actor.effects.find(i => i.data.label === \"Dead\");\n\t\t\tif (dead) await actor.deleteEmbeddedDocuments(\"ActiveEffect\", [dead.id]);\n\t\t\tlet uncon = actor.effects.find(i => i.data.label === \"Unconscious\");\n\t\t\tif (uncon) await actor.deleteEmbeddedDocuments(\"ActiveEffect\", [uncon.id]);\n\t\t\t\n            let effect = actor.effects.find(i => i.data.label === \"Death Ward\");\n            await actor.deleteEmbeddedDocuments(\"ActiveEffect\", [effect.id]);\n        }\n    });\n    DAE.setFlag(tactor, \"DeathWardHook\", hookId);\n}\nasync function RemoveHook() {\n    let flag = await DAE.getFlag(tactor, 'DeathWardHook');\n    Hooks.off(\"preUpdateActor\", flag);\n    await DAE.unsetFlag(tactor, \"DeathWardHook\");\n}",
          "folder": null,
          "sort": 0,
          "permission": {
            "default": 0
          },
          "flags": {}
        }
      }
    },
    "scene-packer": {
      "sourceId": "Item.NB87qotLjoo7wYFo",
      "hash": "e2e0113bd38fba2a6ad5827c14eb989ea8740aff"
    },
    "exportSource": {
      "world": "Curse of Strahd",
      "system": "dnd5e",
      "coreVersion": "9.280",
      "systemVersion": "1.6.3"
    }
  }
}
{
  "name": "Suggestion",
  "type": "spell",
  "img": "https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/air-burst-magenta-2.jpg",
  "data": {
    "description": {
      "value": "<p>You suggest a course of activity (limited to a sentence or two) and magically influence a creature you can see within range that can hear and understand you. Creatures that can't be charmed are immune to this effect. The suggestion must be worded in such a manner as to make the course of action sound reasonable. Asking the creature to stab itself, throw itself onto a spear, immolate itself, or do some other obviously harmful act ends the spell.</p><p>The target must make a Wisdom saving throw. On a failed save, it pursues the course of action you described to the best of its ability. The suggested course of action can continue for the entire duration. If the suggested activity can be completed in a shorter time, the spell ends when the subject finishes what it was asked to do.</p><p>You can also specify conditions that will trigger a special activity during the duration. For example, you might suggest that a knight give her warhorse to the first beggar she meets. If the condition isn't met before the spell expires, the activity isn't performed.</p><p>If you or any of your companions damage the target, the spell ends.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "PHB pg. 279",
    "activation": {
      "type": "action",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 8,
      "units": "hour"
    },
    "target": {
      "value": 1,
      "width": null,
      "units": "",
      "type": "creature"
    },
    "range": {
      "value": 30,
      "long": 0,
      "units": "ft"
    },
    "uses": {
      "value": 0,
      "max": "0",
      "per": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "save",
    "attackBonus": 0,
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": ""
    },
    "damage": {
      "parts": [],
      "versatile": "",
      "value": ""
    },
    "formula": "",
    "save": {
      "ability": "wis",
      "dc": 0,
      "scaling": "spell"
    },
    "level": 2,
    "school": "enc",
    "components": {
      "value": "",
      "vocal": true,
      "somatic": false,
      "material": true,
      "ritual": false,
      "concentration": true
    },
    "materials": {
      "value": "A snake's tongue and either a bit of honeycomb or a drop of sweet oil",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": false
    },
    "scaling": {
      "mode": "none",
      "formula": ""
    },
    "attunement": null
  },
  "effects": [
    {
      "_id": "o63rfcbzc6n7fuvb",
      "changes": [],
      "disabled": false,
      "duration": {
        "startTime": null
      },
      "icon": "https://assets.forge-vtt.com/bazaar/systems/dnd5e/assets/icons/spells/air-burst-magenta-2.jpg",
      "label": "Suggestion",
      "origin": "Scene.FUPTWFp6Y5pDPwos.Token.nXd2JxOjDerQ83Hg.Item.4opv68i4m8bfxjxo",
      "transfer": false,
      "flags": {
        "dae": {
          "selfTarget": false,
          "stackable": "none",
          "durationExpression": "",
          "macroRepeat": "startEveryTurn",
          "specialDuration": [],
          "transfer": false
        },
        "core": {
          "statusId": "Suggestion"
        },
        "dnd5e-helpers": {
          "rest-effect": "Ignore"
        },
        "ActiveAuras": {
          "isAura": false,
          "aura": "None",
          "radius": null,
          "alignment": "",
          "type": "",
          "ignoreSelf": false,
          "height": false,
          "hidden": false,
          "displayTemp": false,
          "hostile": false,
          "onlyOnce": false
        }
      },
      "tint": null
    }
  ],
  "flags": {
    "core": {
      "sourceId": "Compendium.dnd5e.spells.zMAWdyc8UVb37BK4"
    },
    "scene-packer": {
      "hash": "245e8f676a8e70174cb135463f26bfc0235ee94f",
      "sourceId": "Item.ykEfttHVyAjWVFCH"
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "midi-qol": {
      "effectActivation": false,
      "forceCEOn": false,
      "onUseMacroName": "[postActiveEffects]ItemMacro"
    },
    "midiProperties": {
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "rollOther": false,
      "critOther": false,
      "magicdam": false,
      "magiceffect": false,
      "concentration": false,
      "toggleEffect": false
    },
    "itemacro": {
      "macro": {
        "_id": null,
        "name": "Suggestion",
        "type": "script",
        "author": "ckiTPzlaPztdkjV6",
        "img": "icons/svg/dice-target.svg",
        "scope": "global",
        "command": "// suggestion\n\nconst lastArg = args[args.length - 1];\nconst tokenOrActor = await fromUuid(lastArg.tokenUuid);\nconst tactor = tokenOrActor.actor ? tokenOrActor.actor : tokenOrActor;\n\nif (args[0].tag === \"OnUse\" && args[0].failedSaveUuids.length > 0) {\n\n\tconst tokenOrActorTarget = await fromUuid(lastArg.failedSaveUuids[0]);\n    const tactorTarget = tokenOrActorTarget.actor ? tokenOrActorTarget.actor : tokenOrActorTarget;\n    if (!tactorTarget) MidiQOL.error(\"No target for Suggestion found\");\n\n\tlet dialog = new Promise((resolve, reject) => {\n\t\tnew Dialog({\n\t\ttitle: \"Suggestion: Usage Configuration\",\n\t\tcontent: `\n\t\t<form id=\"suggestion-use-form\">\n\t\t\t<p>` + game.i18n.format(\"DND5E.AbilityUseHint\", {name: \"Suggestion\", type: \"feature\"}) + `</p>\n\t\t\t<p>Choose a suggestion.</p>\n\t\t\t<form>\n\t\t\t\t<input id=\"suggestion\" type=\"text\" \n\t\t\t\tpattern=\"^[a-zA-Z]+$\"/>\n\t\t\t</form>\n\t\t</form>\n\t\t`,\n\t\tbuttons: {\n\t\t\tone: {\n\t\t\t\ticon: '<i class=\"fas fa-check\"></i>',\n\t\t\t\tlabel: \"Confirm\",\n\t\t\t\tcallback: () => resolve(document.getElementById('suggestion').value)\n\t\t\t},\n\t\t\ttwo: {\n\t\t\t\ticon: '<i class=\"fas fa-times\"></i>',\n\t\t\t\tlabel: \"Cancel\",\n\t\t\t\tcallback: () => {resolve(false)}\n\t\t\t}\n\t\t},\n\t\tdefault: \"two\",\n\t\tclose: callBack => {resolve(false)}\n\t\t}).render(true);\n\t});\n\tsuggestion = await dialog;\n\t\n\tconst ef = await tactorTarget.effects.find(i => i.data.label === \"Suggestion\" && i.parent === tactor);\n    const changes = [\n        { key: \"flags.midi-qol.suggestion\", mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: suggestion, priority: 20 },\n        { key: `macro.itemMacro`, mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: \"\", priority: 20 },\n    ];\n\tif (ef) {\n        ef.update({ changes : changes });\n    }\n}\n\nif (args[0] === \"each\") {\n\tlet suggestion = getProperty(tactor.data.flags, \"midi-qol.suggestion\");\n\tnew Dialog({\n\t\ttitle: \"Suggestion\",\n\t\tcontent: `\n\t\t<form id=\"suggestion-form\">\n\t\t\t<p>\n                You are magically compelled to follow the suggestion: <br>\n                \"${suggestion}\"\n            </p>\n\t\t</form>\n\t\t`,\n\t\tbuttons: {\n\t\t\tone: {\n\t\t\t\ticon: '<i class=\"fas fa-check\"></i>',\n\t\t\t\tlabel: \"Ok\",\n\t\t\t},\n\t\t},\n\t\tdefault: \"one\",\n\t\t}).render(true);\n}",
        "folder": null,
        "sort": 0,
        "permission": {
          "default": 0
        },
        "flags": {}
      }
    },
    "exportSource": {
      "world": "dnd5e",
      "system": "dnd5e",
      "coreVersion": "9.280",
      "systemVersion": "1.6.3"
    }
  }
}
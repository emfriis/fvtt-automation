{
  "name": "Dragon's Breath",
  "type": "spell",
  "img": "systems/dnd5e/icons/skills/affliction_14.jpg",
  "data": {
    "description": {
      "value": "<p>You touch one willing creature and imbue it with the power to spew magical energy from its mouth, provided it has one. Choose acid, cold, fire, lightning, or poison. Until the spell ends, the creature can use an action to exhale energy of the chosen type in a 15-foot cone. Each creature in that area must make a Dexterity saving throw, taking 3d6 damage of the chosen type on a failed save, or half as much damage on a successful one.</p>\n<p><em><strong>At Higher Levels.</strong></em> When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "Xanathar's Guide to Everything pg 154",
    "activation": {
      "type": "bonus",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 1,
      "units": "minute"
    },
    "target": {
      "value": null,
      "width": null,
      "units": "",
      "type": "ally"
    },
    "range": {
      "value": null,
      "long": null,
      "units": "touch"
    },
    "uses": {
      "value": null,
      "max": "",
      "per": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "util",
    "attackBonus": 0,
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": ""
    },
    "damage": {
      "parts": [],
      "versatile": "",
      "value": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "level": 2,
    "school": "trs",
    "components": {
      "value": "a hot pepper",
      "vocal": true,
      "somatic": true,
      "material": true,
      "ritual": false,
      "concentration": true
    },
    "materials": {
      "value": "a hot pepper",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": true
    },
    "scaling": {
      "mode": "none",
      "formula": ""
    }
  },
  "effects": [],
  "flags": {
    "ddbimporter": {
      "id": 137980,
      "definitionId": 14832,
      "entityTypeId": 435869154,
      "dndbeyond": {
        "lookup": "classSpell",
        "class": "Wizard",
        "level": 3,
        "characterClassId": 116918941,
        "spellLevel": 2,
        "ability": "int",
        "mod": 4,
        "dc": 15,
        "cantripBoost": false,
        "overrideDC": false,
        "id": 137980,
        "entityTypeId": 435869154,
        "healingBoost": 0,
        "usesSpellSlot": true
      },
      "originalName": "Dragon's Breath",
      "sources": [
        {
          "sourceId": 27,
          "pageNumber": 154,
          "sourceType": 1
        }
      ],
      "tags": [
        "Damage",
        "Buff"
      ],
      "version": "2.9.67",
      "effectsApplied": true,
      "importId": "pd5q290isltnqno1"
    },
    "spell-class-filter-for-5e": {
      "parentClass": "wizard"
    },
    "scene-packer": {
      "hash": "92a3049806659db9866cbb00edbe6e1c217ebad4",
      "sourceId": "Item.X0by7QvNZTg0Rb1T"
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "midi-qol": {
      "effectActivation": false,
      "onUseMacroName": "[preActiveEffects]ItemMacro"
    },
    "midiProperties": {
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "rollOther": false,
      "critOther": false,
      "magicdam": false,
      "magiceffect": false,
      "concentration": false,
      "toggleEffect": false
    },
    "enhanced-terrain-layer": {
      "multiple": null,
      "elevation": null,
      "depth": null,
      "environment": ""
    },
    "itemacro": {
      "macro": {
        "_id": null,
        "name": "Dragon's Breath",
        "type": "script",
        "author": "ckiTPzlaPztdkjV6",
        "img": "icons/svg/dice-target.svg",
        "scope": "global",
        "command": "// dragon's breath\n\nconst lastArg = args[args.length - 1];\nconst tokenOrActor = await fromUuid(lastArg.actorUuid);\nconst tactor = tokenOrActor.actor ? tokenOrActor.actor : tokenOrActor;\n\nif (args[0].tag === \"OnUse\") {\n    const content = `\n    <div class=\"form-group\">\n    <label>Damage Types : </label>\n    <select name=\"types\"}>\n    <option value=\"acid\">${CONFIG.DND5E.damageTypes[\"acid\"]}</option>\n    <option value=\"cold\">${CONFIG.DND5E.damageTypes[\"cold\"]}</option>\n    <option value=\"fire\">${CONFIG.DND5E.damageTypes[\"fire\"]}</option>\n    <option value=\"lightning\">${CONFIG.DND5E.damageTypes[\"lightning\"]}</option>\n    <option value=\"poison\">${CONFIG.DND5E.damageTypes[\"poison\"]}</option>\n    </select>\n    </div>\n    `;\n    let dialog = new Promise((resolve, reject) => {\n        new Dialog({\n            title: \"Dragon's Breath: Choose a damage type\",\n            content,\n            buttons: {\n                Ok: {\n                    label: \"Ok\",\n                    callback: (html) => {resolve(html.find(\"[name=types]\")[0].value)},\n                },\n                Cancel: {\n                    label: \"Cancel\",\n                    callback: () => {resolve(false)},\n                },\n            },\n            default: \"Cancel\",\n            close: () => {resolve(false)}\n        }).render(true);\n    });\n    type = await dialog;\n    if (!type) return;\n\n    const item = lastArg.item;\n    const target = lastArg.targets[0]?.actor;\n    const spellLevel = lastArg.spellLevel;\n    const spellDC = tactor.data.data.attributes.spelldc;\n    let effectData = [{\n        label: item.name,\n        icon: item.img,\n        changes: [\n            { key: `macro.itemMacro`, mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: `${type} ${spellLevel} ${spellDC}`, priority: 20 },\n        ],\n        origin: lastArg.uuid,\n        duration: { seconds: item.data.duration.value * 60 },\n        disabled: false,\n        flags: { dae: { itemData: item } , core: { statusId: \"Dragon's Breath\" }},\n    }];\n    await target.createEmbeddedDocuments(\"ActiveEffect\", effectData);\n}\n\nif (args[0] === \"on\") {\n    const typeFlavour = args[1].charAt(0).toUpperCase() + args[1].slice(1)\n    const itemData = {\n        name: `Dragon's ${typeFlavour} Breath`,\n        type: \"feat\",\n        data: {\n            activation: { type: \"action\", cost: 1, condition: \"\", },\n            target: { value: 15, units: \"feet\", type: \"cone\", },\n            range: { value: null, long: null, units: \"self\", },\n            actionType: \"save\",\n            chatFlavor: \"\",\n            critical: null,\n            damage: { parts: [[`${args[2] + 1}d6`, args[1]]], versatile: \"\" },\n            save: { ability: \"dex\", dc: args[3], scaling: \"flat\" },\n        },\n        flags: { midiProperties: { halfdam: true, magiceffect: true }, breath: tactor.uuid },\n        img: \"systems/dnd5e/icons/skills/affliction_14.jpg\",\n    };\n    await tactor.createEmbeddedDocuments(\"Item\", [itemData]);\n}\n\nif (args[0] === \"off\") {\n    const breath = tactor.data.items.filter((i) => i.data.flags?.breath === tactor.uuid);\n    if (breath.length > 0) await tactor.deleteEmbeddedDocuments(\"Item\", breath.map((s) => s.id));\n}",
        "folder": null,
        "sort": 0,
        "permission": {
          "default": 0
        },
        "flags": {}
      }
    },
    "core": {
      "sourceId": "Item.X0by7QvNZTg0Rb1T"
    },
    "exportSource": {
      "world": "dnd5e",
      "system": "dnd5e",
      "coreVersion": "9.280",
      "systemVersion": "1.6.3"
    }
  }
}
{
  "name": "Branding Smite",
  "type": "spell",
  "img": "icons/magic/fire/dagger-rune-enchant-flame-orange.webp",
  "data": {
    "description": {
      "value": "<p>The next time you hit a creature with a weapon attack before this spell ends, the weapon gleams with astral radiance as you strike. The attack deals an extra 2d6 radiant damage to the target, which becomes visible if it is invisible, and the target sheds dim light in a 5-foot radius and can’t become invisible until the spell ends. </p>\n<p><strong>At Higher Levels. </strong>When you cast this spell using a spell slot of 3rd level or higher, the extra damage increases by 1d6 for each slot level above 2nd.</p>",
      "chat": "<p>The next time you hit a creature with a weapon attack before this spell ends, the weapon gleams with astral radiance as you strike. The attack deals an extra 2d6 radiant damage to the target, which becomes visible if it is invisible, and the target sheds dim light in a 5-foot radius and can’t become invisible until the spell ends. </p>\n<p><strong>At Higher Levels. </strong>When you cast this spell using a spell slot of 3rd level or higher, the extra damage increases by 1d6 for each slot level above 2nd.</p>",
      "unidentified": ""
    },
    "source": "Basic Rules, Player's Handbook pg 219",
    "activation": {
      "type": "bonus",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 1,
      "units": "minute"
    },
    "target": {
      "value": null,
      "width": null,
      "units": "",
      "type": "self"
    },
    "range": {
      "value": null,
      "long": null,
      "units": "self"
    },
    "uses": {
      "value": 0,
      "max": "0",
      "per": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "util",
    "attackBonus": "0",
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": ""
    },
    "damage": {
      "parts": [],
      "versatile": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "level": 2,
    "school": "evo",
    "components": {
      "value": "",
      "vocal": true,
      "somatic": false,
      "material": false,
      "ritual": false,
      "concentration": true
    },
    "materials": {
      "value": "",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": false
    },
    "scaling": {
      "mode": "level",
      "formula": "1d6"
    }
  },
  "effects": [],
  "flags": {
    "ddbimporter": {
      "id": 307827,
      "definitionId": 2326,
      "entityTypeId": 435869154,
      "dndbeyond": {
        "lookup": "generic",
        "lookupName": "generic",
        "level": null,
        "castAtLevel": null
      },
      "sources": [
        {
          "sourceId": 1,
          "pageNumber": null,
          "sourceType": 2
        },
        {
          "sourceId": 2,
          "pageNumber": 219,
          "sourceType": 1
        }
      ],
      "tags": [
        "Damage",
        "Control"
      ]
    },
    "betterRolls5e": {
      "quickVersatile": {
        "altValue": true
      },
      "quickCharges": {
        "value": {
          "use": true,
          "resource": true
        },
        "altValue": {
          "use": true,
          "resource": true
        }
      }
    },
    "core": {
      "sourceId": "Compendium.world.ddb-darklands-spells.WCXokAA12WcY0Xfx"
    },
    "enhanced-terrain-layer": {
      "multiple": 1,
      "min": 0,
      "max": 0,
      "environment": "",
      "elevation": null,
      "depth": null
    },
    "midi-qol": {
      "criticalThreshold": "20",
      "onUseMacroName": "[postActiveEffects]ItemMacro",
      "effectActivation": false
    },
    "itemacro": {
      "macro": {
        "data": {
          "_id": null,
          "name": "Branding Smite",
          "type": "script",
          "author": "otqBqyqMuTGDffTr",
          "img": "icons/svg/dice-target.svg",
          "scope": "global",
          "command": "async function wait(ms) { return new Promise(resolve => { setTimeout(resolve, ms); }); }\nconst lastArg = args[args.length - 1];\nconst tokenD = canvas.tokens.get(lastArg.tokenId);\nconst actorD = tokenD.actor;\nconst gameRound = game.combat ? game.combat.round : 0;\nconst spellDC = actorD.data.data.attributes.spelldc;\n\nif (args[0].tag === \"OnUse\") {\n    let itemD = lastArg.item;\n    let effectData = [{\n        changes: [\n            { key: \"flags.dnd5e.DamageBonusMacro\", mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: `ItemMacro.${itemD.name}`, priority: 20 },\n            { key: \"flags.midi-qol.BrandingSmite.Damage\", mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: `${lastArg.spellLevel}`, priority: 20 },\n            { key: \"flags.midi-qol.itemDetails\", mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: `${lastArg.uuid}`, priority: 20 }\n        ],\n        origin: lastArg.uuid,\n        disabled: false,\n        duration: { rounds: 1, startRound: gameRound, startTime: game.time.worldTime },\n        flags: { dae: { itemData: itemD, specialDuration: [\"1Hit\"] } },\n        icon: itemD.img,\n        label: game.i18n.localize(itemD.name)\n    }];\n    await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: tokenD.actor.uuid, effects: effectData });\n}\nif (args[0].tag === \"DamageBonus\") {\n    if (![\"mwak\"].includes(lastArg.item.data.actionType)) return {};\n    let tokenD = canvas.tokens.get(lastArg.tokenId);\n    let itemUuid = getProperty(actorD.data.flags, \"midi-qol.itemDetails\");\n    let itemD = await fromUuid(itemUuid);\n    let target = canvas.tokens.get(lastArg.hitTargets[0].id);\n    let spellLevel = getProperty(actorD.data.flags, \"midi-qol.BrandingSmite.Damage\");\n    let damageType = \"radiant\";\n    let damageDice = await new game.dnd5e.dice.DamageRoll(`${spellLevel}d6[${damageType}]`, actorD.getRollData(), { critical: lastArg.isCritical }).evaluate({ async: true });\n    let invisNames = [\"Invisible\", \"Invisibility\"];\n    let invis = target.actor.effects.find(i => invisNames.includes(i.data.label));\n    let conc = tokenD.actor.effects.find(i => i.data.label === game.i18n.localize(\"Concentrating\"));\n    if (conc) {\n        let concUpdate = await getProperty(actorD.data.flags, \"midi-qol.concentration-data.targets\");\n        await concUpdate.push({ tokenUuid: target.document.uuid, actorUuid: target.actor.uuid });\n        await actorD.setFlag(\"midi-qol\", \"concentration-data.targets\", concUpdate);\n    }\n    if (invis) {\n        await MidiQOL.socket().executeAsGM(\"removeEffects\", { actorUuid: target.actor.uuid, effects: [invis.id] });        \n    } else if (target.data.hidden) {\n        if(!(game.modules.get(\"warpgate\")?.active)) return {};\n        let updates = {\n            token: { hidden: false }\n        }\n        let mutateCallbacks = \"\";\n        await warpgate.mutate(target.document, updates, mutateCallbacks, { permanent: true });\n    }\n    let effectData = [{\n        changes: [\n            { key: `data.traits.ci.value`, mode: CONST.ACTIVE_EFFECT_MODES.ADD, value: \"invisible\", priority: 20 },\n            { key: `flags.dae.deleteUuid`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: conc.uuid, priority: 20 },\n            { key: `ATL.light.alpha`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: \"0.09\", priority: 20 },\n            { key: `ATL.light.animation`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: `{\"type\": \"pulse\", \"speed\":3, \"intensity\":3}`, priority: 20 },\n            { key: `ATL.light.dim`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: 5, priority: 20 },\n            { key: `ATL.light.bright`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: \"0\", priority: 20 },\n            { key: `ATL.light.color`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: \"#b8fffa\", priority: 20 }\n        ],\n        origin: itemUuid,\n        disabled: false,\n        duration: { rounds: 10, startRound: gameRound, startTime: game.time.worldTime },\n        icon: itemD.img,\n        label: game.i18n.localize(itemD.name)\n    }];\n    let branded = target.actor.effects.find(i => i.data.label === game.i18n.localize(itemD.name));\n    if (!branded) await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: target.actor.uuid, effects: effectData });\n    return { damageRoll: damageDice.formula, flavor: `(${game.i18n.localize(itemD.name)} (${CONFIG.DND5E.damageTypes[damageType]}))` };\n}",
          "folder": null,
          "sort": 0,
          "permission": {
            "default": 0
          },
          "flags": {}
        }
      }
    },
    "midiProperties": {
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "rollOther": false,
      "critOther": false,
      "magicdam": false,
      "magiceffect": false,
      "concentration": false,
      "toggleEffect": false
    },
    "exportSource": {
      "world": "Curse of Strahd",
      "system": "dnd5e",
      "coreVersion": "9.280",
      "systemVersion": "1.6.3"
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "scene-packer": {
      "sourceId": "Item.0ArT9R43V9vSHXWp",
      "hash": "11e235cffa617943aabe0a11e39ef1b3e058c238"
    }
  }
}
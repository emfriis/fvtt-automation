{
  "name": "Spirit Guardians",
  "type": "spell",
  "img": "systems/dnd5e/icons/spells/needles-sky-2.jpg",
  "data": {
    "description": {
      "value": "<p>You call forth spirits to protect you. They flit around you to a distance of 15 feet for the duration. If you are good or neutral, their spectral form appears angelic or fey (your choice). If you are evil, they appear fiendish.</p>\n<p>When you cast this spell, you can designate any number of creatures you can see to be unaffected by it. An affected creature's speed is halved in the area, and when the creature enters the area for the first time on a turn or starts its turn there, it must make a Wisdom saving throw. On a failed save, the creature takes 3d8 radiant damage (if you are good or neutral) or 3d8 necrotic damage (if you are evil). On a successful save, the creature takes half as much damage.</p>\n<p><strong>At Higher Levels.</strong> When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for each slot level above 3rd.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "Basic Rules, Player's Handbook pg 278",
    "activation": {
      "type": "action",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": 10,
      "units": "minute"
    },
    "target": {
      "value": null,
      "width": null,
      "units": "",
      "type": "self"
    },
    "range": {
      "value": 15,
      "long": null,
      "units": "ft"
    },
    "uses": {
      "value": null,
      "max": "",
      "per": ""
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": null,
    "actionType": "",
    "attackBonus": 0,
    "chatFlavor": "[3d8 - radiant] Good or Neutral Alignment, [3d8 - necrotic] Evil Alignment",
    "critical": {
      "threshold": null,
      "damage": ""
    },
    "damage": {
      "parts": [],
      "versatile": "",
      "value": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "level": 3,
    "school": "con",
    "components": {
      "value": "a holy symbol",
      "vocal": true,
      "somatic": true,
      "material": true,
      "ritual": false,
      "concentration": true
    },
    "materials": {
      "value": "a holy symbol",
      "consumed": false,
      "cost": 0,
      "supply": 0
    },
    "preparation": {
      "mode": "prepared",
      "prepared": false
    },
    "scaling": {
      "mode": "level",
      "formula": "1d8"
    },
    "attunement": null
  },
  "effects": [
    {
      "label": "Spirit Guardians",
      "icon": "systems/dnd5e/icons/spells/needles-sky-2.jpg",
      "changes": [
        {
          "key": "data.attributes.movement.all",
          "mode": 0,
          "value": "/2",
          "priority": "20"
        },
        {
          "key": "flags.midi-qol.OverTime",
          "mode": 2,
          "value": "turn=start,label=Spirit Guardians (Start of Turn),damageRoll=(@spellLevel)d8,damageType=radiant,saveRemove=false,saveDC=@attributes.spelldc,saveAbility=wis,saveDamage=halfdamage,killAnim=true",
          "priority": "20"
        },
        {
          "key": "macro.itemMacro",
          "mode": 0,
          "value": "@token @spellLevel @attributes.spelldc",
          "priority": "20"
        }
      ],
      "duration": {
        "startTime": null
      },
      "tint": null,
      "transfer": false,
      "disabled": false,
      "flags": {
        "dae": {
          "transfer": false,
          "stackable": "none",
          "selfTarget": true,
          "durationExpression": "",
          "macroRepeat": "none",
          "specialDuration": []
        },
        "ddbimporter": {
          "disabled": false
        },
        "midi-qol": {
          "forceCEOff": true
        },
        "ActiveAuras": {
          "isAura": true,
          "aura": "Enemy",
          "radius": 15,
          "alignment": "",
          "type": "",
          "ignoreSelf": true,
          "height": true,
          "hidden": false,
          "hostile": false,
          "onlyOnce": false,
          "displayTemp": true
        },
        "core": {
          "statusId": ""
        },
        "dnd5e-helpers": {
          "rest-effect": "Ignore"
        }
      },
      "_id": "wai7uc6872q0jwq3",
      "selectedKey": [
        "data.attributes.movement.all",
        "flags.midi-qol.OverTime",
        "macro.itemMacro"
      ]
    }
  ],
  "flags": {
    "ddbimporter": {
      "id": 138784,
      "definitionId": 2264,
      "entityTypeId": 435869154,
      "dndbeyond": {
        "lookup": "generic",
        "lookupName": "generic",
        "level": null,
        "castAtLevel": null
      },
      "originalName": "Spirit Guardians",
      "sources": [
        {
          "sourceId": 1,
          "pageNumber": null,
          "sourceType": 2
        },
        {
          "sourceId": 2,
          "pageNumber": 278,
          "sourceType": 1
        }
      ],
      "tags": [
        "Damage",
        "Control"
      ],
      "version": "2.9.59",
      "effectsApplied": true
    },
    "betterRolls5e": {
      "quickVersatile": {
        "altValue": true
      },
      "quickCharges": {
        "value": {
          "use": true,
          "resource": true
        },
        "altValue": {
          "use": true,
          "resource": true
        }
      }
    },
    "itemacro": {
      "macro": {
        "data": {
          "_id": null,
          "name": "Spirit Guardians",
          "type": "script",
          "author": "otqBqyqMuTGDffTr",
          "img": "icons/svg/dice-target.svg",
          "scope": "global",
          "command": "const lastArg = args[args.length - 1];\n\n// Check when applying the effect - if the token is not the caster and it IS the tokens turn they take damage\nif (args[0] === \"on\" && args[1] !== lastArg.tokenId && lastArg.tokenId === game.combat?.current.tokenId) {\n  const sourceItem = await fromUuid(lastArg.origin);\n  const tokenOrActor = await fromUuid(lastArg.actorUuid);\n  const theActor = tokenOrActor.actor ? tokenOrActor.actor : tokenOrActor;\n  const damageType = \"radiant\";\n\n  const itemData = mergeObject(\n    duplicate(sourceItem.data),\n    {\n      type: \"weapon\",\n      effects: [],\n      flags: {\n        \"midi-qol\": {\n          noProvokeReaction: true, // no reactions triggered\n          onUseMacroName: null, //\n        },\n      },\n      data: {\n        equipped: true,\n        actionType: \"save\",\n        save: { dc: Number.parseInt(args[3]), ability: \"wis\", scaling: \"flat\" },\n        damage: { parts: [[`${args[2]}d8`, damageType]] },\n        \"target.type\": \"self\",\n        components: { concentration: false, material: false, ritual: false, somatic: false, value: \"\", vocal: false },\n        duration: { units: \"inst\", value: undefined },\n        weaponType: \"improv\",\n      },\n    },\n    { overwrite: true, inlace: true, insertKeys: true, insertValues: true }\n  );\n  itemData.data.target.type = \"self\";\n  setProperty(itemData.flags, \"autoanimations.killAnim\", true);\n  const item = new CONFIG.Item.documentClass(itemData, { parent: theActor });\n  const options = { showFullCard: false, createWorkflow: true, versatile: false, configureDialog: false };\n  await MidiQOL.completeItemRoll(item, options);\n}",
          "folder": null,
          "sort": 0,
          "permission": {
            "default": 0
          },
          "flags": {}
        }
      }
    },
    "core": {
      "sourceId": "Compendium.world.ddb-spells.Pr4wMEvTyI5syVzL"
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "scene-packer": {
      "sourceId": "Item.GlBwj3P8loEJjtqV",
      "hash": "c4d90452fa695166d4377698d6eb855d4b74c880"
    },
    "exportSource": {
      "world": "Curse of Strahd",
      "system": "dnd5e",
      "coreVersion": "9.280",
      "systemVersion": "1.6.3"
    }
  }
}
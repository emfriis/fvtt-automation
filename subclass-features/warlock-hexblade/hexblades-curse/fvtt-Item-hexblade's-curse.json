{
  "name": "Hexblade's Curse",
  "type": "feat",
  "img": "icons/magic/death/projectile-skull-flaming-green.webp",
  "data": {
    "description": {
      "value": "<p>Starting at 1st level, you gain the ability to place a baleful curse on someone. As a bonus action, choose one creature you can see within 30 feet of you. The target is cursed for 1 minute. The curse ends early if the target dies, you die, or you are incapacitated. Until the curse ends, you gain the following benefits:</p>\n<ul>\n<li>You gain a bonus to damage rolls against the cursed target. The bonus equals your proficiency bonus.</li>\n</ul>\n<ul>\n<li>Any attack roll you make against the cursed target is a critical hit on a roll of 19 or 20 on the d20.</li>\n</ul>\n<ul>\n<li>If the cursed target dies, you regain hit points equal to your warlock level + your Charisma modifier (minimum of 1 hit point).</li>\n</ul>\n<p>You canâ€™t use this feature again until you finish a short or long rest.</p>",
      "chat": "",
      "unidentified": ""
    },
    "source": "",
    "activation": {
      "type": "bonus",
      "cost": 1,
      "condition": ""
    },
    "duration": {
      "value": null,
      "units": ""
    },
    "target": {
      "value": 1,
      "width": null,
      "units": "",
      "type": "creature"
    },
    "range": {
      "value": 30,
      "long": null,
      "units": "ft"
    },
    "uses": {
      "value": 1,
      "max": "1",
      "per": "sr"
    },
    "consume": {
      "type": "",
      "target": "",
      "amount": null
    },
    "ability": "",
    "actionType": "util",
    "attackBonus": 0,
    "chatFlavor": "",
    "critical": {
      "threshold": null,
      "damage": null
    },
    "damage": {
      "parts": [],
      "versatile": ""
    },
    "formula": "",
    "save": {
      "ability": "",
      "dc": null,
      "scaling": "spell"
    },
    "requirements": "",
    "recharge": {
      "value": null,
      "charged": false
    },
    "attunement": 0
  },
  "effects": [],
  "flags": {
    "itemacro": {
      "macro": {
        "data": {
          "_id": null,
          "name": "Hexblade's Curse",
          "type": "script",
          "author": "otqBqyqMuTGDffTr",
          "img": "icons/svg/dice-target.svg",
          "scope": "global",
          "command": "async function wait(ms) { return new Promise(resolve => { setTimeout(resolve, ms); }); }\nconst lastArg = args[args.length - 1];\nif (args[0].tag === \"OnUse\" && args[0].macroPass !== \"preAttackRoll\") {\n    const target = canvas.tokens.get(lastArg.targets[0].id);\n    const tokenD = canvas.tokens.get(lastArg.tokenId);\n    const itemD = lastArg.item;\n    const game_round = game.combat ? game.combat.round : 1;\n    if (target.actor.effects.find(i => i.data.label === \"Hexblade Life Tap\")) return ui.notifications.warn(`Target is already under the effects of ${itemD.name}.`);\n    return new Promise(async (resolve) => {\n        await bonusDamage(target, itemD, tokenD, game_round);\n        await lifeTap(target, itemD, tokenD, game_round);\n        resolve();\n        if ((!(game.modules.get(\"jb2a_patreon\")?.active)) && (!(game.modules.get(\"sequencer\")?.active))) return {};\n        new Sequence()\n            .effect()\n            .file(\"jb2a.spell_projectile.skull.pinkpurple\")\n            .atLocation(tokenD)\n            .stretchTo(target)\n            .waitUntilFinished(-500)\n            .play()\n    });\n}\n\nasync function bonusDamage(target, itemD, tokenD, game_round) {\n    const effectData = {\n        changes: [\n            { key: \"flags.midi-qol.hexbladeMark\", mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: target.id, priority: 20 },\n            { key: \"flags.dnd5e.DamageBonusMacro\", mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: `ItemMacro.${itemD.name}`, priority: 20 },\n            { key: \"flags.midi-qol.onUseMacroName\", mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: `ItemMacro.${itemD.name}, preAttackRoll`, priority: 20 }\n        ],\n        origin: lastArg.uuid,\n        disabled: false,\n        flags: { dae: { itemData: itemD, specialDuration: [\"zeroHP\"] } },\n        duration: { rounds: 10, startRound: game_round, startTime: game.time.worldTime },\n        icon: \"systems/dnd5e/icons/skills/affliction_04.jpg\",\n        label: `Hexblade Bonus Damage`\n    }\n    await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: tokenD.actor.uuid, effects: [effectData] });\n}\n\nasync function lifeTap(target, itemD, tokenD, game_round) {\n    let effect = await tokenD.actor.effects.find(i => i.data.label === \"Hexblade Bonus Damage\");\n    let effectData = {\n        label: `Hexblade Life Tap`,\n        icon: \"systems/dnd5e/icons/skills/affliction_01.jpg\",\n        origin: lastArg.uuid,\n        disabled: false,\n        duration: { rounds: 10, startRound: game_round, startTime: game.time.worldTime },\n        flags: {\n            \"dae\": { tokenId: tokenD.id, itemData: itemD }\n        },\n        changes: [\n            { key: \"macro.execute\", mode: CONST.ACTIVE_EFFECT_MODES.CUSTOM, value: \"HexSupport\", priority: 20 },\n            { key: \"flags.midi-qol.hexEffect\", mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: \"Hexblade\", priority: 20 },\n            { key: `flags.dae.deleteUuid`, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, value: effect.uuid, priority: 20 }\n        ]\n    };\n    await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: target.actor.uuid, effects: [effectData] });\n}\n\nif (args[0].tag === \"OnUse\" && args[0].macroPass === \"preAttackRoll\") {\n    const target = canvas.tokens.get(lastArg.targets[0].id);\n    const tokenD = canvas.tokens.get(lastArg.tokenId);\n    const itemD = lastArg.item;\n    if (![\"mwak\", \"rwak\", \"msak\", \"rsak\"].includes(lastArg.item.data.actionType)) return {};\n    if (target.id !== getProperty(tokenD.actor.data.flags, \"midi-qol.hexbladeMark\")) return {};\n    let effect = tokenD.actor.effects.find(i=> i.data.label === `Hexblade Critical`);\n    let effectData = {\n        label: `Hexblade Critical`,\n        icon: \"systems/dnd5e/icons/skills/affliction_01.jpg\",\n        origin: \"\",\n        disabled: false,\n        flags: { dae: { itemData: itemD.data, specialDuration: [\"1Attack:mwak\",\"1Attack:rwak\",\"1Attack:msak\",\"1Attack:msak\",\"1Attack:rsak\",\"turnEnd\",\"zeroHP\"] } },\n        changes: [\n            { key: \"flags.dnd5e.weaponCriticalThreshold\", mode: CONST.ACTIVE_EFFECT_MODES.UPGRADE, value: 19, priority: 20 },\n            { key: \"flags.dnd5e.spellCriticalThreshold\", mode: CONST.ACTIVE_EFFECT_MODES.UPGRADE, value: 19, priority: 20 }\n        ]\n    };\n    if (!effect) await MidiQOL.socket().executeAsGM(\"createEffects\", { actorUuid: tokenD.actor.uuid, effects: [effectData] });\n}\n\n// Dropped Critical Only Dice are doubled\nif (args[0].tag === \"DamageBonus\") {\n    const target = canvas.tokens.get(lastArg.targets[0].id);\n    const tokenD = canvas.tokens.get(lastArg.tokenId);\n    if (![\"mwak\", \"rwak\", \"msak\", \"rsak\"].includes(lastArg.item.data.actionType)) return {};\n    if (target.id !== getProperty(tokenD.actor.data.flags, \"midi-qol.hexbladeMark\")) return {};\n    let damageType = lastArg.damageDetail[0].type;\n    let damageNumber = await new game.dnd5e.dice.DamageRoll(`@prof[${damageType}]`, tokenD.actor.getRollData(), { critical: false }).evaluate({ async: true });\n    return { damageRoll: damageNumber.formula, flavor: `(Hexblade Damage)`, damageList: lastArg.damageList };\n}",
          "folder": null,
          "sort": 0,
          "permission": {
            "default": 0
          },
          "flags": {}
        }
      }
    },
    "magicitems": {
      "enabled": false,
      "equipped": false,
      "attuned": false,
      "charges": "0",
      "chargeType": "c1",
      "destroy": false,
      "destroyFlavorText": "reaches 0 charges: it crumbles into ashes and is destroyed.",
      "rechargeable": false,
      "recharge": "0",
      "rechargeType": "t1",
      "rechargeUnit": "r1",
      "sorting": "l"
    },
    "core": {
      "sourceId": "Item.Zb2dFfCNTVqd8A8q"
    },
    "midi-qol": {
      "onUseMacroName": "[postActiveEffects]ItemMacro",
      "effectActivation": false
    },
    "exportSource": {
      "world": "Curse of Strahd",
      "system": "dnd5e",
      "coreVersion": "9.280",
      "systemVersion": "1.6.3"
    },
    "midiProperties": {
      "nodam": false,
      "fulldam": false,
      "halfdam": false,
      "rollOther": false,
      "critOther": false,
      "magicdam": false,
      "magiceffect": false,
      "concentration": false,
      "toggleEffect": false
    },
    "rest-recovery": {
      "data": {
        "recovery": {
          "enabled": false
        }
      }
    },
    "scene-packer": {
      "hash": "bb06f4d878bbab0c028b32bee9541a91fce30170",
      "sourceId": "Item.ts0NTLWU8nmUa6na"
    },
    "link-item-resource-5e": {
      "resource-link": ""
    }
  }
}
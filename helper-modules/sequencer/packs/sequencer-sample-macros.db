{"name":"Sequencer-Spell-5e-Generic-Magic-Effect","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/symbols/runes-triangle-blue.webp","scope":"global","command":"// Requires the ____PAID____ JB2A module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\n// You can also run this directly on a selected token, or if you have targets, you can run it on them\n\nlet error = false;\nif(!game.modules.get(\"jb2a_patreon\")){\n    error = `You need to have the full (patreon) version of JB2A installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\n\nlet targets = [];\nif(typeof args !== \"undefined\" && args.length !== 0){\n    targets = args[0].targets;\n}else{\n    let userTargets = Array.from(game.user.targets);\n    if(userTargets.length){\n        for(let target of userTargets){\n            if(!targets.includes(target)) targets.push(target);\n        }\n    }else{\n\t\tif(token) targets.push(token);\n\t}\n}\n\nlet sequence = new Sequence()\nfor(let target of targets){\n    sequence.effect()\n        .file(\"jb2a.explosion.05\")\n        .atLocation(target)\n        .scale(0.3)\n        .randomRotation()\n}\nsequence.play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.zW1mk5Uk00qebTRz"}},"_id":"785pDKOe1wZAVWIu"}
{"name":"Sequencer-Oujia-Board","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/tools/scribal/lens-grey-brown.webp","scope":"global","command":"// ---------------------------\n// MAP\nconst letter_a = { x: 231.1892510005717, y: 445.45454545454555 }; // ok\nconst letter_b = { x: 292.1097770154374, y: 404.8885077186964 }; // ok\nconst letter_c = { x: 349.28530588907967, y: 379.0451686678102 }; // ok\nconst letter_d = { x: 404.3739279588336, y: 361.1206403659233 };\nconst letter_e = { x: 461.7209834190966, y: 348.8564894225272 };\nconst letter_f = { x: 514.9228130360204, y: 336.79245283018867 }; // ok\nconst letter_g = { x: 577.1869639794168, y: 333.96226415094344 };\nconst letter_h = { x: 637.9073756432248, y: 333.01886792452837 };\nconst letter_i = { x: 691.1092052601487, y: 334.9056603773585 };\nconst letter_j = { x: 738.8507718696399, y: 340.3659233847914 };\nconst letter_k = { x: 801.2864493996568, y: 353.94511149228146 };\nconst letter_l = { x: 862.607204116638, y: 375.2715837621499 };\nconst letter_m = { x: 928.2447112635791, y: 402.42995997712984 };\nconst letter_n = { x: 999.5425957690106, y: 437.70726129216706 };\nconst letter_o = { x: 257.8044596912522, y: 517.3241852487137 };\nconst letter_p = { x: 311.0062893081762, y: 490.53744997141234 }; // ok\nconst letter_q = { x: 373.0703259005145, y: 467.52429959977144 };\nconst letter_r = { x: 433.2475700400228, y: 447.54145225843365 };\nconst letter_s = { x: 495.31160663236125, y: 430.9319611206406 }; // ok\nconst letter_t = { x: 550.7718696397942, y: 422.2698684962837 };\nconst letter_u = { x: 612.264150943396, y: 419.81132075471714 };\nconst letter_v = { x: 679.4168096054887, y: 418.29616923956564 };\nconst letter_w = { x: 758.8336192109775, y: 434.13379073756437 };// ok\nconst letter_x = { x: 848.1132075471695, y: 463.2075471698115 };\nconst letter_y = { x: 914.1509433962261, y: 489.6226415094342 };\nconst letter_z = { x: 971.698113207547, y: 522.6415094339625 };\n\nconst number_1 = { x: 340.8233276157804, y: 591.8524871355062 };\nconst number_2 = { x: 394.9685534591192, y: 591.2807318467698 };\nconst number_3 = { x: 453.2590051457976, y: 594.8827901658092 };\nconst number_4 = { x: 512.2927387078329, y: 597.7129788450545 };\nconst number_5 = { x: 570.583190394511, y: 596.9696969696971 };\nconst number_6 = { x: 627.3584905660376, y: 599.0566037735852 };\nconst number_7 = { x: 679.5883361921095, y: 594.139508290452 };\nconst number_8 = { x: 735.4202401372212, y: 592.9959977129793 };\nconst number_9 = { x: 791.8238993710692, y: 590.5374499714126 };\nconst number_0 = { x: 860.491709548313, y: 591.109205260149 };\n\nconst symbol_yes = { x: 321.5551743853629, y: 229.81703830760478 };\nconst symbol_no = { x: 906.7467124070897, y: 227.73013150371685 };\n\nconst symbol_space = { x: 603.7735849056602, y: 233.96226415094372 };\n\nconst symbol_01 = { x: 608.3190394511147, y: 697.5986277873074 };\nconst symbol_02 = { x: 639.9536577292289, y: 699.8675935120822 };\nconst symbol_03 = { x: 639.9536577292289, y: 699.8675935120822 };\nconst symbol_04 = { x: 639.9536577292289, y: 699.8675935120822 };\nconst symbol_05 = { x: 639.9536577292289, y: 699.8675935120822 };\nconst symbol_06 = { x: 639.9536577292289, y: 699.8675935120822 };\n\nconst bottomLocation = { x: 607.1601354620223, y: 785.2926947266571 };\n\n// YOU CAN TRY TO MESS WITH THIS\nlet soundToPlay = 'modules/sequencer/samples/OujiaBoard/assets_sounds_distant-orchestra.ogg';\nlet animation = 'modules/animated-spell-effects-cartoon/spell-effects/cartoon/mix/electric_ball_CIRCLE_09.webm';\n\nlet soundToPlayEnd = 'modules/sequencer/samples/OujiaBoard/assets_sounds_intensive-stare.ogg';\nlet animationEnd = 'modules/animated-spell-effects-cartoon/spell-effects/cartoon/misc/demon_face_SQUARE.webm';\n\n/* Ouija Board Control\nSource:\nIcon: icons/tools/scribal/lens-grey-brown.webp\n*/\n\nconst debug = true;\nconst version =  'v1.3';\nlet tokenD;\n\nif (canvas.tokens.controlled[0]===undefined){\n    ui.notifications.error(\"You must select a token!\");\n} else {\n    tokenD=canvas.tokens.controlled[0];\n    main();\n}\n\n\nfunction main() {\n    let alphabet = 'abcdefghijklmnopqrstuvwxyz0123456789'.split('');\n    let alphabetList = ``;\n    let special = 'yes,no'.split(',');\n    alphabet = alphabet.concat(special);\n    alphabet.map((t) => {\n        alphabetList += `<input type=\"radio\" id=\"${t}\" name=\"target\" value=\"${t}\"><label for=\"${t}\">${t} </label>`;\n    });\n    \n    let choosenMessage = chooseMessage();\n    \n    let template = `\n    <style type=\"text/css\">\n      div.purpleHorizon {\n        border: 4px solid #ff0000;\n        background-color: #000000;\n        width: 100%;\n        text-align: center;\n        border-collapse: collapse;\n      }\n      .divTable.purpleHorizon .divTableCell, .divTable.purpleHorizon .divTableHead {\n        border: 0px solid #550000;\n        padding: 5px 2px;\n      }\n      .divTable.purpleHorizon .divTableBody .divTableCell {\n        font-size: 13px;\n        font-weight: bold;\n        color: #FFFFFF;\n      }\n      \n      .divTable{ display: table; }\n      .divTableRow { display: table-row; }\n      .divTableHeading { display: table-header-group;}\n      .divTableCell, .divTableHead { display: table-cell;}\n      .divTableHeading { display: table-header-group;}\n      .divTableFoot { display: table-footer-group;}\n      .divTableBody { display: table-row-group;}\n      /* RADIO */\n      [type=radio] {\n        background-color:white;\n      }\n      /* IMAGE STYLES */\n      [type=radio] + img {\n      cursor: pointer;\n      }\n      /* CHECKED STYLES */\n      [type=radio]:checked + img {\n      outline: 4px solid #f00;\n      }\n      \n      .container {\n        position: relative;\n        text-align: center;\n        color: white;\n      }\n      /* Centered text */\n      .centered {\n        position: absolute;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        font-size: 18px;\n      }\n      #kultcss .window-content {\n        background: #000000;\n      }\n      #kultcss .dialog-button {\n        height: 40px;\n        background: #000000;\n        color: #ffffff;\n        justify-content: space-evenly;\n        align-items: center;\n        cursor: pointer;\n        border: none;\n      }\n      #kultcss header {\n        background: #000000;\n        border-radius: 0;\n        border: none;\n        margin-bottom: 2px;\n        font-size: .75rem;\n      }\n    </style>\n    \n    <div class=\"divTable purpleHorizon\">\n    <div class=\"divTableBody\">\n    \n    <div class=\"divTableRow\">\n    <div class=\"divTableCell\">\n        <p>${choosenMessage}</p>\n    </div>\n    </div>\n    <div class=\"divTableRow\">\n    <div class=\"divTableCell\">\n        <p>Message</p>\n        <input id=\"message\" type=\"text\" style=\"width: 320px; box-sizing: border-box;border: none;background-color: #ff0000;color: white; text-align: center;\" value=\"wasp\">\n    </div>\n    </div>\n    <div class=\"divTableRow\">\n    <div class=\"divTableCell\">\n      <p>Choose instead of the message:</p>\n      <input type=\"radio\" id=\"position_yes\" name=\"extra_position\" value=\"message\" checked=\"checked>\n      <label for=\"support_0\">Message</label>\n      <input type=\"radio\" id=\"position_yes\" name=\"extra_position\" value=\"position_yes\">\n      <label for=\"support_0\">Yes</label>\n      <input type=\"radio\" id=\"position_no\" name=\"extra_position\" value=\"position_no\">\n      <label for=\"support_1\">No</label>\n      <input type=\"radio\" id=\"position_01\" name=\"extra_position\" value=\"position_01\">\n      <label for=\"support_1\">Extra 01</label>\n      <input type=\"radio\" id=\"position_02\" name=\"extra_position\" value=\"position_02\">\n      <label for=\"support_1\">Extra 02</label>\n      <input type=\"radio\" id=\"position_03\" name=\"extra_position\" value=\"position_03\">\n      <label for=\"support_1\">Extra 03</label>\n      <input type=\"radio\" id=\"position_04\" name=\"extra_position\" value=\"position_04\">\n      <label for=\"support_1\">Extra 04</label>\n      <input type=\"radio\" id=\"position_05\" name=\"extra_position\" value=\"position_05\">\n      <label for=\"support_1\">Extra 05</label>\n      <input type=\"radio\" id=\"position_06\" name=\"extra_position\" value=\"position_06\">\n      <label for=\"support_1\">Extra 06</label>\n    </div>\n    </div>\n    <div class=\"divTableRow\">\n    <div class=\"divTableCell\">\n      <label for=\"movetype\">Move Type: <select id=\"movetype\" style=\"width: 250px; box-sizing: border-box;border: none;background-color: #ff0000;color: white; text-align: center;\">\n      <option value=\"moveType1\">Type 1</option>\n      <option value=\"moveType2\">Type 2 - No Sound</option>\n      <option value=\"moveType3\">Type 3 - Animation</option>\n      <option value=\"moveType4\">Type 4 - End</option>\n      </select></label>\n    </div>\n    </div>\n    <div class=\"divTableRow\">\n    <div class=\"divTableCell\">\n        <label for=\"extraTime\">Delay (ms):\n        <input id=\"extraTime\" type=\"number\" min=1 max=5000 style=\"width: 80px; box-sizing: border-box;border: none;background-color: #ff0000;color: white; text-align: center;\" value=1></label>\n    </div>\n    </div>\n    </div>\n    </div>\n  `;\n    \n    new Dialog({\n        title: `Ouija - ${version}`,\n        content: template,\n        buttons: {\n            ok: {\n                label: \"Move\",\n                callback: async (html) => {\n                    moveThing(html);\n                },\n            },\n            cancel: {\n                label: \"Cancel\",\n            },\n        },\n    }).render(true);\n}\n\nasync function moveThing(html) {\n    let msg = '';\n    const movetype = html.find('#movetype')[0].value;\n    let autoMessage =  html.find(\"#message\")[0].value;\n    let extraTime =  html.find(\"#extraTime\")[0].value;\n    let messageType = html.find('input[name=\"extra_position\"]:checked')[0].value;\n    const moveFunction = await selectMoveFunction(movetype);\n    \n    if ( messageType=='message' ) { // message\n        sendMessage(autoMessage.toLowerCase(), moveFunction, extraTime);\n    } else { // extra_position\n        sendToPosition(messageType.toLowerCase(), moveFunction, extraTime);\n    }\n}\n\nasync function move3(position, extraTime=1) {\n    let sequence = new Sequence()\n        .animation()\n        .on(tokenD)\n        .duration(1000)\n        .moveTowards(position, { ease: \"easeInOutCubic\" } )\n        .rotateTowards(bottomLocation, { duration: 1000, ease: \"easeInOutCubic\" })\n        .waitUntilFinished()\n        .sound(soundToPlay)\n        .effect()\n        .file(animation)\n        .attachTo(tokenD)\n        .scaleToObject(0.75)\n        .spriteOffset({ y: -0.33 }, { gridUnits: true })\n        .waitUntilFinished()\n        .wait(extraTime);\n    \n    await sequence.play();\n}\n\nasync function move2(position, extraTime=1) {\n    let sequence = new Sequence()\n        .animation()\n        .on(tokenD)\n        .duration(1000)\n        .moveTowards(position, { ease: \"easeInOutCubic\" } )\n        .rotateTowards(bottomLocation, { duration: 1000, ease: \"easeInOutCubic\" })\n        .waitUntilFinished()\n        .wait(extraTime);\n    \n    await sequence.play();\n}\n\nasync function move(position, extraTime=1) {\n    let sequence = new Sequence()\n        .animation()\n        .on(tokenD)\n        .duration(1000)\n        .moveTowards(position, { ease: \"easeInOutCubic\" } )\n        .rotateTowards(bottomLocation, { duration: 1000, ease: \"easeInOutCubic\" })\n        .waitUntilFinished()\n        .sound(soundToPlay)\n        .wait(200)\n        .wait(extraTime);\n    \n    await sequence.play();\n}\n\nasync function moveEnd(position, extraTime=1) {\n    let sequence = new Sequence()\n        .animation()\n        .on(tokenD)\n        .duration(1000)\n        .moveTowards(position, { ease: \"easeInOutCubic\" } )\n        .rotateTowards(bottomLocation, { duration: 1000, ease: \"easeInOutCubic\" })\n        .waitUntilFinished()\n        .sound(soundToPlayEnd)\n        .effect()\n        .file(animationEnd)\n        .atLocation(tokenD)\n        .scale(0.55)\n        .waitUntilFinished()\n        .wait(extraTime);\n    \n    await sequence.play();\n}\n\nasync function sendMessage(text, moveFunction, extraTime=1) {\n    let message = text.split('');\n    \n    for (let index = 0; index < message.length; index++) {\n        const myMessage = message[index];\n        const output = await moveFunction(sceneMap(myMessage), extraTime);\n    }\n}\n\nasync function sendToPosition(text, moveFunction, extraTime=1) {\n    await moveFunction(sceneMap(text), extraTime);\n}\n\nasync function selectMoveFunction(moveType) {\n    if (moveType=='moveType1') {\n        return move;\n    } else if (moveType=='moveType2') {\n        return move2;\n    } else if (moveType=='moveType3') {\n        return move3;\n    } else if (moveType=='moveType4') {\n        return moveEnd;\n    }\n}\n\n// ================================================================\nfunction sceneMap(message) {\n// canvas.tokens.controlled[0].position.x\n// canvas.tokens.controlled[0].position.y\n    \n    // 1 char\n    switch (message) {\n        case 'a': return letter_a; // ok\n        case 'b': return letter_b; // ok\n        case 'c': return letter_c; // ok\n        case 'd': return letter_d;\n        case 'e': return letter_e;\n        case 'f': return letter_f; // ok\n        case 'g': return letter_g;\n        case 'h': return letter_h;\n        case 'i': return letter_i;\n        case 'j': return letter_j;\n        case 'k': return letter_k;\n        case 'l': return letter_l;\n        case 'm': return letter_m;\n        case 'n': return letter_n;\n        case 'o': return letter_o;\n        case 'p': return letter_p; // ok\n        case 'q': return letter_q;\n        case 'r': return letter_r;\n        case 's': return letter_s; // ok\n        case 't': return letter_t;\n        case 'u': return letter_u;\n        case 'v': return letter_v;\n        case 'x': return letter_x;\n        case 'z': return letter_z;\n        case 'w': return letter_w; // ok\n        case 'y': return letter_y;\n        case '0': return number_0;\n        case '1': return number_1;\n        case '2': return number_2;\n        case '3': return number_3;\n        case '4': return number_4;\n        case '5': return number_5;\n        case '6': return number_6;\n        case '7': return number_7;\n        case '8': return number_8;\n        case '9': return number_9;\n        case ' ': return symbol_space;\n        case 'position_yes':  return symbol_yes;\n        case 'position_no':   return symbol_no;\n        case 'position_01':   return symbol_01;\n        case 'position_02':   return symbol_02;\n        case 'position_03':   return symbol_03;\n        case 'position_04':   return symbol_04;\n        case 'position_05':   return symbol_05;\n        case 'position_06':   return symbol_06;\n        default: ui.notifications.error(\"666!\");\n    }\n}\n\nfunction chooseMessage() {\n    let messages = [\n        \"Captain Howdy is looking for you\",\n        \"Perform the whole ritual in a consecrated circle, so that undesirable spirits cannot interfere with it.\",\n        \"Never look behind you while speaking with the dead.\",\n        \"Playing with spirits may bring you dire consequences.\"\n    ]\n    return messages[Math.floor(Math.random() * messages.length)];\n}","folder":null,"sort":0,"permission":{"default":0,"2ncowBJEJHGJW7JM":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.lzjQrzpo6QdTGT3l"}},"_id":"8WZy4CvJzwlHc2EM"}
{"name":"Sequencer-Chains","type":"script","author":"sW3E9DC6Z4EcEfdv","img":"icons/tools/fasteners/chain-steel-blue.webp","scope":"global","command":"const source = canvas.tokens.controlled[0];\n\nif(!source){\n    ui.notifications.error(\"You need to select a token for the chain to start on!\");\n    return;\n}\n\nconst target = Array.from(game.user.targets)?.[0]\n\nif(!target){\n    ui.notifications.error(\"You need to target a token for the chain to end on!\");\n    return;\n}\n\n\nnew Sequence()\n    .effect()\n        .file(\"modules/sequencer/samples/Bindings/chain.png\")\n        .attachTo(source)\n        .stretchTo(target, { attachTo: true })\n        .template({ gridSize: 200 })\n        .tilingTexture()\n        .scale(0.5)\n        .belowTokens()\n        .persist()\n    .play()","folder":null,"sort":0,"permission":{"default":0,"sW3E9DC6Z4EcEfdv":3},"flags":{"core":{"sourceId":"Macro.swHtsdLC8SMMg5nZ"}},"_id":"CdY9Tapj5qeBKjJO"}
{"name":"Sequencer-Spell-5e-Generic-Healing","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/life/heart-cross-strong-green.webp","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\n// You can also run this directly on a selected token, or if you have targets, you can run it on them\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\") || game.modules.get(\"JB2A_DnD5e\"))){\n    error = `You need to have JB2A installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\n\nlet targets = [];\nif(typeof args !== \"undefined\" && args.length !== 0){\n    targets = args[0].targets;\n}else{\n    let userTargets = Array.from(game.user.targets);\n    if(userTargets.length){\n        for(let target of userTargets){\n            if(!targets.includes(target)) targets.push(target);\n        }\n    }else{\n\t\tif(token) targets.push(token);\n\t}\n}\n\nlet sequence = new Sequence()\nfor(let target of targets){\n    sequence.effect()\n        .atLocation(target)\n        .file(\"jb2a.healing_generic.200px.green\")\n}\nsequence.play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.rTXQknjILCNabjxF"}},"_id":"KGNr5PJVPwV7a50L"}
{"name":"Sequencer-VFX-Chain-Lightning-Simple","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/lightning/bolt-strike-sparks-teal.webp","scope":"global","command":"// Requires the JB2A module (free or patreon)\n// Select a token, then target a set of tokens, and run this macro\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\")?.active || game.modules.get(\"JB2A_DnD5e\")?.active)){\n    error = `You need to have JB2A installed and activated to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet current_target = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nif(targets.indexOf(current_target) > -1){\n    targets = targets.filter(t => t !== current_target);\n}\n\nlet origin = current_target;\nlet [firstTarget] = targets.splice(0, 1); // This removes the first target from the list, and makes it the first target\n\nlet sequence = new Sequence(); // Create a new sequence\n\nsequence.effect()\n    .file(\"jb2a.chain_lightning.primary.blue\")\n    .atLocation(origin) // Going from origin\n    .stretchTo(firstTarget) // To the current loop's target\n    .wait(600)\n\n// then it jumps from the first target, to the next target, and so on\norigin = firstTarget;\n\nfor(let target of targets){\n    sequence.effect()\n        .file(\"jb2a.chain_lightning.secondary.blue\")\n        .atLocation(origin) // Going from origin\n        .stretchTo(target) // To the current loop's target\n    .effect()\n        .file(\"jb2a.static_electricity.02.blue02\")\n        .atLocation(target) // Static on the target\n        .scaleToObject(1.5) // Scale so it fits the target\n        .randomRotation() // Randomly rotate the effect so it's not the same for each token\n    .wait(200) // Slight delay between each arc\n\n    origin = target; // Then make current target the new origin\n}\n\nsequence.play()","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.8SJxOa7Y4naxAAP1"}},"_id":"Kd5RVey2DdacMczP"}
{"name":"Sequencer-Oujia-GetTokenXY","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/tools/hand/ruler-steel-grey.webp","scope":"global","command":"// Get Token XY\n\n/*\nicon: icons/tools/hand/ruler-steel-grey.webp\n*/\n\n/*\ntoken.data.rotation\nhttps://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki/Animations#move-towards\n*/\n\nlet tokenD;\nconst version = 'v1.0';\n\nif (canvas.tokens.controlled[0]===undefined){\n  ui.notifications.error(\"You must select a token!\");    \n} else {\n  tokenD=canvas.tokens.controlled[0];\n  main();\n}\n\nasync function main() {\n  let message='';\n  let finalCode = `{ x: ${tokenD.position.x}, y: ${tokenD.position.y} }`;\n  \n  message += `<ul><li>X: <b style=\"color:red\">${tokenD.position.x}</b></li>`;\n  message += `<li>Y: <b style=\"color:red\">${tokenD.position.y}</b></li></ul>`;\n  \n  message += `<b style=\"color:red\" id=\"#tokenposition\">{ ${tokenD.position.x}, ${tokenD.position.y} }</p>`;\n  message += `<p>Copied to clipboard.</p>`;\n\n  \n\tlet template = message;\n\n\t/* view */\n\tlet form = `\n\t\t<label>Copy this</label>\n\t\t<textarea id=\"moduleTextArea\" rows=\"3\" cols=\"33\">${finalCode}</textarea>\n\t`;\n\n\tlet dialog = new Dialog({\n\t\ttitle: `Token Data - ${version}`,\n\t\tcontent: form,\n\t\tbuttons: {\n\t\t\tuse: {\n\t\t\t\tlabel: \"Copy to Clipboard\",\n\t\t\t\tcallback: () => {\n\t\t\t\t\tlet copyText = document.getElementById(\"moduleTextArea\"); /* Get the text field */\n\t\t\t\t\tcopyText.select(); /* Select the text field */\n\t\t\t\t\tdocument.execCommand(\"copy\"); /* Copy the text inside the text field */\n\t\t\t\t\tui.notifications.notify(`Saved on Clipboard`); /* Alert the copied text */\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}).render(true);\n}","folder":null,"sort":0,"permission":{"default":0,"aOfXzApnXawxRa3U":3,"2ncowBJEJHGJW7JM":3},"flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.eQIamhUfNNRxCKrI"}},"_id":"StMKahYH8aaXbZRN"}
{"name":"Sequencer-Spell-5e-Misty-Step","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/control/debuff-energy-snare-purple-blue.webp","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Then add this macro's name to the bottom of the Misty Step spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\") || game.modules.get(\"JB2A_DnD5e\"))){\n    error = `You need to have JB2A installed to run this macro!`;\n}\n\nif(!game.modules.get(\"warpgate\")?.active){\n    let installed = game.modules.get(\"warpgate\") && !game.modules.get(\"warpgate\").active ? \"enabled\" : \"installed\";\n    error = `You need to have WarpGate ${installed} to run this macro!`;\n}\n\nconst tokenD = typeof args !== \"undefined\" && args.length !== 0 ? canvas.tokens.get(args?.[0]?.tokenId) : token;\n\nif(!tokenD){\n    error = `Could not find the token to teleport!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet range = await canvas.scene.createEmbeddedDocuments('MeasuredTemplate', [{\n    t: \"circle\",\n    user: game.user._id,\n    x: tokenD.x + canvas.grid.size / 2,\n    y: tokenD.y + canvas.grid.size / 2,\n    direction: 0,\n    distance: 30,\n    borderColor: \"#FF0000\"\n}]);\n\nlet position = await warpgate.crosshairs.show({\n    size: 1,\n    tag: randomID(),\n    label: \"Teleport to\",\n    drawOutline: false,\n    drawIcon: false\n}, { show: async (crosshair) => {\n\n    new Sequence()\n        .effect()\n            .from(tokenD)\n            .attachTo(crosshair)\n            .persist()\n            .opacity(0.5)\n        .play();\n\n}})\n\nawait range[0].delete();\n\nnew Sequence()\n    .effect()\n        .file(\"jb2a.misty_step.01.blue\")\n        .atLocation(tokenD)\n        .randomRotation()\n        .scaleToObject(2)\n    .wait(750)\n    .animation()\n        .on(tokenD)\n        .opacity(0.0)\n        .waitUntilFinished()\n    .animation()\n        .on(tokenD)\n        .teleportTo(position)\n        .snapToGrid()\n        .waitUntilFinished()\n    .effect()\n        .file(\"jb2a.misty_step.02.blue\")\n        .atLocation(tokenD)\n        .randomRotation()\n        .scaleToObject(2)\n    .wait(1500)\n    .animation()\n        .on(tokenD)\n        .opacity(1.0)\n    .play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"furnace":{"runAsGM":false},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.0nao3mhIvaNzxmgx"}},"_id":"UXtbvgGdZUfyCl5M"}
{"name":"Sequencer-Rope","type":"script","author":"sW3E9DC6Z4EcEfdv","img":"icons/sundries/survival/rope-wrapped-yellow.webp","scope":"global","command":"const source = canvas.tokens.controlled[0];\n\nif(!source){\n    ui.notifications.error(\"You need to select a token for the rope to start on!\");\n    return;\n}\n\nconst target = Array.from(game.user.targets)?.[0]\n\nif(!target){\n    ui.notifications.error(\"You need to target a token for the rope to end on!\");\n    return;\n}\n\n\nnew Sequence()\n    .effect()\n        .file(\"modules/sequencer/samples/Bindings/rope.png\")\n        .attachTo(source)\n        .stretchTo(target, { attachTo: true })\n        .tilingTexture()\n        .template({ gridSize: 200 })\n        .scale(0.5)\n        .belowTokens()\n        .persist()\n    .play()","folder":null,"sort":0,"permission":{"default":0,"sW3E9DC6Z4EcEfdv":3},"flags":{"core":{"sourceId":"Macro.vutd41UisoqE0IW0"}},"_id":"X8PNqllfRRd3UeKS"}
{"name":"Sequencer-Spell-5e-Acid-Splash","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/acid/projectile-faceted-glob.webp","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Acid Splash spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!game.modules.get(\"animated-spell-effects-cartoon\")){\n    error = `You need to have the module \"Jack Kerouac's Animated Spell Effects: Cartoon\" installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet targets = [];\nif(typeof args !== \"undefined\" && args.length !== 0){\n    targets = Array.from(args[0]?.failedSaves);\n}else{\n    let userTargets = Array.from(game.user.targets);\n    if(userTargets.length){\n        for(let target of userTargets){\n            if(!targets.includes(target)) targets.push(target);\n        }\n    }else {\n\t\tif(token) targets.push(token);\n\t}\n}\n\nif(targets.length){\n    new Sequence()\n        .effect()\n            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/water/acid_splash_CIRCLE_01.webm\")\n            .atLocation(targets[0])\n            .scale(0.3, 0.6)\n            .randomRotation()\n        .effect()\n        .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/water/acid_splash_CIRCLE_01.webm\")\n            .atLocation(targets[1] ?? false)\n            .scale(0.3, 0.6)\n            .randomRotation()\n            .delay(300)\n            .playIf(targets.length === 2)\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.K2iB1URLuK9ZxYsD"}},"_id":"XYsBVWjipoQy5AK5"}
{"name":"Sequencer-Spell-5e-Faerie-Fire","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/light/orbs-firefly-hand-yellow.webp","scope":"global","command":"// Requires the JB2A module - if you're using their free version, change the path to point to the right location\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Faerie Fire spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\") || game.modules.get(\"JB2A_DnD5e\"))){\n    error = `You need to have JB2A installed to run this macro!`;\n}\n\nif(!game.modules.get(\"advanced-macros\")?.active){\n    let installed = game.modules.get(\"advanced-macros\") && !game.modules.get(\"advanced-macros\").active ? \"enabled\" : \"installed\";\n    error = `You need to have Advanced Macros ${installed} to run this macro!`;\n}\n\nif(!game.modules.get(\"midi-qol\")?.active){\n    let installed = game.modules.get(\"midi-qol\") && !game.modules.get(\"midi-qol\").active ? \"enabled\" : \"installed\";\n    error = `You need to have MidiQOL ${installed} to run this macro!`;\n}\n\nif(typeof args === 'undefined' || args.length === 0){\n    error = `You can't run this macro from the hotbar! This is a callback macro. To use this, enable MidiQOL settings in \"Workflow\" -> \"Add macro to call on use\", then add this macro's name to the bottom of the Misty Step spell in the \"On Use Macro\" field.`;\n}\n\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet configSettings = game.settings.get(\"midi-qol\", \"ConfigSettings\");\nif(configSettings.autoTarget === \"none\"){\n    Hooks.once(\"createMeasuredTemplate\", runMacro);\n}else{\n    runMacro({_id: args[0].templateId});\n}\n\nasync function runMacro(template){\n\n    let templateC = canvas.templates.placeables.find(t => t.id === template._id);\n\n    if(templateC){\n\n        new Sequence()\n            .effect()\n                .file(\"jb2a.fireflies.few.01.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .effect()\n                .file(\"jb2a.fireflies.few.02.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .effect()\n                .file(\"jb2a.fireflies.many.01.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .effect()\n                .file(\"jb2a.fireflies.many.02.red\")\n                .atLocation(templateC)\n                .scaleToObject()\n                .fadeOut(500)\n            .waitUntilFinished()\n            .thenDo(() => {\n                try {\n                    canvas.scene.deleteEmbeddedDocuments(\"MeasuredTemplate\", [templateC._id]);\n                }catch(err){}\n            })\n            .play()\n    }\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.Ci4ls0VomA950hYI"}},"_id":"YY7ODwqauPETTSNK"}
{"name":"Sequencer-Spell-5e-Sword-Burst","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/skills/melee/blade-tips-double-blue.webp","scope":"global","command":"// Requires the Jack Kerouac's Animated Spell Effects: Cartoon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of any spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!game.modules.get(\"animated-spell-effects-cartoon\")){\n    error = `You need to have the module \"Jack Kerouac's Animated Spell Effects: Cartoon\" installed to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\n// You can also run this directly on a selected token\nlet tokenD = typeof args !== \"undefined\" && args.length !== 0 ? canvas.tokens.get(args?.[0]?.tokenId) : token;\n\nif(tokenD) {\n    new Sequence()\n        .effect()\n            .file(\"modules/animated-spell-effects-cartoon/spell-effects/cartoon/magic/magic_sphere_1token_SQUARE.webm\")\n            .atLocation(tokenD)\n            .scale(1.5)\n            .template({ gridSize: 100 })\n            .randomRotation()\n        .play()\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.dxxGCIwWWBa9RQvB"}},"_id":"etbc8j34ZkPRq5ag"}
{"name":"Sequencer-Spell-5e-Detect-Magic","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/symbols/runes-star-pentagon-blue.webp","scope":"global","command":"// Requires the JB2A patreon module\n// Requires Advanced Macros and MidiQOL with Workflow -> Add macro to call on use\n// Then add this macro's name to the bottom of the Detect Magic spell in the \"On Use Macro\" field\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\"))){\n    error = `You need to have JB2A's patreon only module installed to run this macro!`;\n}\n\nif(!game.modules.get(\"advanced-macros\")?.active){\n    let installed = game.modules.get(\"advanced-macros\") && !game.modules.get(\"advanced-macros\").active ? \"enabled\" : \"installed\";\n    error = `You need to have Advanced Macros ${installed} to run this macro!`;\n}\n\nif(!game.modules.get(\"midi-qol\")?.active){\n    let installed = game.modules.get(\"midi-qol\") && !game.modules.get(\"midi-qol\").active ? \"enabled\" : \"installed\";\n    error = `You need to have MidiQOL ${installed} to run this macro!`;\n}\n\nif(typeof args === 'undefined' || args.length === 0){\n    error = `You can't run this macro from the hotbar! This is a callback macro. To use this, enable MidiQOL settings in \"Workflow\" -> \"Add macro to call on use\", then add this macro's name to the bottom of the Detect Magic spell in the \"On Use Macro\" field.`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nconst tokenD = canvas.tokens.get(args[0].tokenId);\n\nlet magicalObjects = [];\n\nif(game.modules.get(\"tagger\")?.active){\n\n\tlet magicalSchools = [\"abjuration\", \"conjuration\", \"divination\", \"enchantment\", \"evocation\", \"illusion\", \"necromancy\", \"transmutation\"];\n\tlet magicalColors = [\"blue\", \"green\", \"pink\", \"purple\", \"red\", \"yellow\"];\n\n\tlet objects = Tagger.getByTag(\"magical\", { ignore: [tokenD] });\n\n\tmagicalObjects = objects.map(o => {\n\t\t\tlet distance = canvas.grid.measureDistance(tokenD, o);\n\t\t\treturn {\n\t\t\t\tdelay: distance * 55,\n\t\t\t\tdistance: distance,\n\t\t\t\tobj: o,\n\t\t\t\tschool: Tagger.getTags(o).find(t => magicalSchools.includes(t.toLowerCase())) || false,\n\t\t\t\tcolor: Tagger.getTags(o).find(t => magicalColors.includes(t.toLowerCase())) || \"blue\"\n\t\t\t}\n\t\t})\n\t\t.filter(o => o.distance <= 32.5)\n\n}\n\nlet sequence = new Sequence()\n\t.effect(\"jb2a.detect_magic.circle.blue\")\n\t\t.atLocation(tokenD)\n\t\t.belowTiles()\n\t\t.size(13.75 * canvas.grid.size)\n\nfor(let magical of magicalObjects){\n\n\tif(!magical.school) continue;\n\n\tnew Sequence()\n\t\t.effect(\"jb2a.magic_signs.rune.{{school}}.intro.{{color}}\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.scale(0.25)\n\t\t\t.delay(magical.delay)\n\t\t\t.setMustache(magical)\n\t\t\t.waitUntilFinished(-800)\n\t\t\t.zIndex(0)\n\t\t.effect(\"jb2a.magic_signs.rune.{{school}}.loop.{{color}}\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.scale(0.25)\n\t\t\t.setMustache(magical)\n\t\t\t.fadeOut(500)\n\t\t\t.waitUntilFinished(-800)\n\t\t\t.zIndex(1)\n\t\t.effect(\"jb2a.magic_signs.rune.{{school}}.outro.{{color}}\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.scale(0.25)\n\t\t\t.setMustache(magical)\n\t\t\t.zIndex(0)\n\t\t.play()\n\n\tnew Sequence()\n\t\t.effect(\"jb2a.detect_magic.cone.blue\")\n\t\t\t.atLocation(magical.obj)\n\t\t\t.stretchTo(tokenD)\n\t\t\t.delay(magical.delay)\n\t\t.play()\n\n}\n\nsequence.play();","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.jRIsiWVlXN43CVjn"}},"_id":"nkOKwuiBmsfO7dtx"}
{"name":"Sequencer-VFX-Chain-Lightning-Complex","type":"script","author":"2ncowBJEJHGJW7JM","img":"icons/magic/lightning/bolts-strike-salvo-blue.webp","scope":"global","command":"// Requires the JB2A module (free or patreon)\n// Select a token, then target a set of tokens in any order, and run this macro.\n\nlet error = false;\nif(!(game.modules.get(\"jb2a_patreon\")?.active || game.modules.get(\"JB2A_DnD5e\")?.active)){\n    error = `You need to have JB2A installed and activated to run this macro!`;\n}\n\nif(error){\n    ui.notifications.error(error);\n    return;\n}\n\nlet origin = canvas.tokens.controlled[0];\nlet targets = Array.from(game.user.targets);\n\nif(targets.indexOf(origin) > -1){\n    targets = targets.filter(t => t !== origin);\n}\n\n// Sort the targeted tokens in from the shortest distance to the longest distance\nlet tokenOrder = [];\nfor(let i = 0; i < targets.length; i++){\n    let potential_targets = targets.filter(item => tokenOrder.indexOf(item) === -1);\n    let from = tokenOrder[tokenOrder.length-1] ?? origin;\n    let closest = potential_targets.reduce((a, b) => findClosestTo(from, a, b));\n    tokenOrder.push(closest);\n}\n\nlet [firstTarget] = tokenOrder.splice(0, 1); // This removes the first target from the list, and makes it the first target\n\nlet sequence = new Sequence(); // Create a new sequence\n\nsequence.effect()\n    .file(\"jb2a.chain_lightning.primary.blue\")\n    .atLocation(origin) // Going from origin\n    .stretchTo(firstTarget) // To the current loop's target\n    .wait(600)\n\n// then it jumps from the first target, to the next target, and so on\norigin = firstTarget;\n\nfor(let target of tokenOrder){\n    sequence.effect()\n        .file(\"jb2a.chain_lightning.secondary.blue\")\n        .atLocation(origin) // Going from origin\n        .stretchTo(target) // To the current loop's target\n    .effect()\n        .file(\"jb2a.static_electricity.02.blue02\")\n        .atLocation(target) // Static on the target\n        .scaleToObject(1.5) // Scale so it fits the target\n        .randomRotation() // Randomly rotate the effect so it's not the same for each token\n    .wait(200) // Slight delay between each arc\n\n    origin = target; // Then make current target the new origin\n}\n\nsequence.play()\n\n// This function finds the closest token from a given origin token\nfunction findClosestTo(from, a, b){\n    let a_dist = canvas.grid.measureDistance(from, a);\n    let b_dist = canvas.grid.measureDistance(from, b);\n    // If the distances are the same, randomly pick one of the two\n    if(a_dist === b_dist){\n        return Math.random() > 0.5 ? a : b;\n    }\n    return a_dist < b_dist ? a : b;\n}","folder":null,"sort":0,"permission":{"default":0,"YK46QS70OGKGnDLG":3,"sW3E9DC6Z4EcEfdv":3,"2ncowBJEJHGJW7JM":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.1aKkG9IYsSN0M9OK"}},"_id":"yQoeRiQ8VaPkXHqH"}
